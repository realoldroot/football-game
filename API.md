#接口文档

---
[TOC]



 地址为`192.168.0.120`，端口号暂定为`8888`
 
 服务端在**120秒**之内如果接受不到来自客户端的数据或心跳包，则会主动断开连接。（未实现）
 TPC连接建立后，服务端在**5秒**之内如果没有校验用户信息，则会主动断开连接。
 
 **数据包结构:  | encode | encrypt | command | length | body | \n |**

|结构    |类型   |解释|
|:-:     |:-----:|:----:|
|tag     |byte   |标签，默认值为0x01|
|encode  |byte   |编码格式，默认值为0x01|
|encrypt |byte   |加密类型，默认值为0x01|
|command |int    |指令，根据指令去解析body|
|length  |int    |长度，body内容的长度|
|body    |string |内容，json序列化之后的对象|
|\r\n    | 0d0a  |系统换行符，用来标志信息结束|

 
---

##1. 初次连接

 **初次连接需要发送用户信息校验登陆:**
- 首次连接发送的数据，举例
```
#command : 1
#请求

         +-------------------------------------------------+
         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
+--------+-------------------------------------------------+----------------+
|00000000| 01 01 01 00 00 00 01 00 00 00 81 7b 22 69 64 22 |...........{"id"|
|00000010| 3a 6e 75 6c 6c 2c 22 75 73 65 72 6e 61 6d 65 22 |:null,"username"|
|00000020| 3a 22 31 38 35 30 30 33 34 30 31 36 39 22 2c 22 |:"18500340169","|
|00000030| 70 61 73 73 77 6f 72 64 22 3a 22 45 31 30 41 44 |password":"E10AD|
|00000040| 43 33 39 34 39 42 41 35 39 41 42 42 45 35 36 45 |C3949BA59ABBE56E|
|00000050| 30 35 37 46 32 30 46 38 38 33 45 22 2c 22 6e 69 |057F20F883E","ni|
|00000060| 63 6b 6e 61 6d 65 22 3a 6e 75 6c 6c 2c 22 74 65 |ckname":null,"te|
|00000070| 61 6d 4e 61 6d 65 22 3a 6e 75 6c 6c 2c 22 68 65 |amName":null,"he|
|00000080| 61 64 69 6d 67 22 3a 6e 75 6c 6c 7d 0a          |adimg":null}.   |
+--------+-------------------------------------------------+----------------+

#body中必要数据 username 和 password
#登陆成功

         +-------------------------------------------------+
         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
+--------+-------------------------------------------------+----------------+
|00000000| 01 01 01 00 00 00 01 00 00 00 1e 7b 22 63 6f 64 |...........{"cod|
|00000010| 65 22 3a 30 2c 22 6d 65 73 73 61 67 65 22 3a 22 |e":0,"message":"|
|00000020| 73 75 63 63 65 73 73 22 7d 0a                   |success"}.      |
+--------+-------------------------------------------------+----------------+
 
 #登陆失败
 
         +-------------------------------------------------+
         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
+--------+-------------------------------------------------+----------------+
|00000000| 01 01 01 00 00 00 01 00 00 00 10 7b 22 63 6f 64 |...........{"cod|
|00000010| 65 22 3a 22 65 72 72 6f 72 22 7d 0a             |e":"error"}     |
+--------+-------------------------------------------------+----------------+
```
如果没有特殊需要返回数据的时候，响应内容统一为上面响应内容，区别在于第**4**到第**7**字节的command指令。

---

###2. 匹配房间

```
#command : 5
#请求
{
}

```
- score 积分，钻石，5钻区还是10钻区（目前只有这俩）

---

###3. 匹配成功
```
#command : 51
#响应
{
  "id": 1527156405613,
  "score": 5,
  "players": {
    "3": {
      "id": 3,
      "username": "18500340169",
      "nickname": "他大爷",
      "roomId": 1527156405613,
      "teamName": "中国",
      "units": {
        "unit1": {
          "x": 0.0,
          "y": 0.0
        },
        "unit2": {
          "x": 0.0,
          "y": 0.0
        },
        "unit3": {
          "x": 0.0,
          "y": 0.0
        },
        "unit4": {
          "x": 0.0,
          "y": 0.0
        },
        "unit5": {
          "x": 0.0,
          "y": 0.0
        }
      },
      "status": 0
    },
    "4": {
      "id": 4,
      "username": "18519207690",
      "nickname": "Hello",
      "roomId": 1527156405613,
      "teamName": "德国",
      "units": {
        "unit1": {
          "x": 0.0,
          "y": 0.0
        },
        "unit2": {
          "x": 0.0,
          "y": 0.0
        },
        "unit3": {
          "x": 0.0,
          "y": 0.0
        },
        "unit4": {
          "x": 0.0,
          "y": 0.0
        },
        "unit5": {
          "x": 0.0,
          "y": 0.0
        }
      },
      "status": 0
    }
  },
  "winner": 0
}

###
```
---

###4 准备。
设置好球员位置，准备开始
```
#command 6
#这里其实是匹配成功的players对象
{
  "id": 3,
  "username": "18500340169",
  "nickname": "他大爷",
  "roomId": 1527156405613,  #房间号
  "teamName": "中国",
  "units": {
    "unit1": {
      "x": 0.0,
      "y": 0.0
    },
    "unit2": {
      "x": 0.0,
      "y": 0.0
    },
    "unit3": {
      "x": 0.0,
      "y": 0.0
    },
    "unit4": {
      "x": 0.0,
      "y": 0.0
    },
    "unit5": {
      "x": 0.0,
      "y": 0.0
    }
  },
  "status": 0 #状态 1为已准备好
}

结构和匹配成功响应的结构一样，不用传入的属性没有展示在上面。
```

---

###5 双方都准备完毕
```
{
  "id": 1527241181216,
  "score": 5,
  "players": {
    "3": {
      "id": 3,
      "username": "18500340169",
      "nickname": "他四大爷",
      "roomId": 1527241181216,
      "teamName": "俄罗斯",
      "units": {
        "unit1": {
          "x": 10.0,
          "y": 10.0
        },
        "unit2": {
          "x": 10.0,
          "y": 10.0
        },
        "unit3": {
          "x": 10.0,
          "y": 10.0
        },
        "unit4": {
          "x": 10.0,
          "y": 10.0
        },
        "unit5": {
          "x": 10.0,
          "y": 10.0
        }
      },
      "status": 1
    },
    "4": {
      "id": 4,
      "username": "18519207690",
      "nickname": "Hello",
      "roomId": 1527241181216,
      "teamName": "德国",
      "units": {
        "unit1": {
          "x": 10.0,
          "y": 10.0
        },
        "unit2": {
          "x": 10.0,
          "y": 10.0
        },
        "unit3": {
          "x": 10.0,
          "y": 10.0
        },
        "unit4": {
          "x": 10.0,
          "y": 10.0
        },
        "unit5": {
          "x": 10.0,
          "y": 10.0
        }
      },
      "status": 1
    }
  },
  "winner": 0
}
```
同样会返回 匹配成功的json格式，和玩家状态都为`status = 1`已准备完毕


---

部分属性的值解释

